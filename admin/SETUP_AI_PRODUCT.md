# دليل إعداد ميزة إضافة المنتج بالذكاء الاصطناعي

## نظرة عامة

هذه الميزة تسمح بإضافة المنتجات بسرعة فائقة باستخدام الذكاء الاصطناعي. فقط صور المنتج وسيقوم النظام بـ:
- ✅ استخراج اسم المنتج (عربي وإنجليزي)
- ✅ كتابة وصف تفصيلي
- ✅ تحديد القسم المناسب
- ✅ إزالة خلفية الصورة
- ✅ رفع الصورة إلى Supabase

---

## الخطوة 1: إعداد Python API (إزالة الخلفية)

### 1.1 تثبيت Python
تأكد من تثبيت Python 3.8 أو أحدث:
```bash
python --version
```

إذا لم يكن مثبتاً، حمله من: https://www.python.org/downloads/

### 1.2 تشغيل Python API

**الطريقة السهلة (Windows):**
```bash
cd admin/python-api
start.bat
```

**الطريقة اليدوية:**
```bash
cd admin/python-api

# إنشاء بيئة افتراضية
python -m venv venv

# تفعيل البيئة الافتراضية
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

# تثبيت المكتبات
pip install -r requirements.txt

# تشغيل الـ API
python remove_bg.py
```

### 1.3 التحقق من عمل الـ API
افتح في المتصفح:
```
http://localhost:5000/health
```

يجب أن ترى:
```json
{"status": "ok", "service": "rembg-api"}
```

---

## الخطوة 2: تشغيل Next.js Admin Panel

في terminal جديد:
```bash
cd admin
npm run dev
```

سيعمل على:
```
http://localhost:3000
```

---

## الخطوة 3: استخدام الميزة

### 3.1 الذهاب إلى صفحة إضافة منتج
1. افتح: http://localhost:3000/products
2. اضغط على زر "إضافة منتج"
3. اختر "إضافة ذكية" (البطاقة البنفسجية)

### 3.2 رفع الصور
1. اختر صورة المنتج من الأمام
2. اختر صورة المنتج من الخلف
3. اضغط "معالجة بالذكاء الاصطناعي"

### 3.3 إدخال البيانات المتبقية
- سيعرض النظام المعلومات المستخرجة تلقائياً
- أدخل السعر بالدينار العراقي
- أدخل الكمية المتوفرة

### 3.4 المراجعة والحفظ
- راجع جميع المعلومات
- اضغط "حفظ المنتج"

---

## البنية التقنية

### المكونات الرئيسية

```
admin/
├── src/
│   ├── app/
│   │   ├── (dashboard)/products/new/
│   │   │   └── page.tsx                    # صفحة اختيار الطريقة
│   │   └── api/ai/
│   │       ├── analyze-product/
│   │       │   └── route.ts                # تحليل الصور بـ Gemini
│   │       └── remove-background/
│   │           └── route.ts                # إزالة الخلفية
│   └── components/products/
│       ├── AIProductForm.tsx               # مكون الإضافة الذكية
│       └── ManualProductForm.tsx           # مكون الإضافة اليدوية
└── python-api/
    ├── remove_bg.py                        # Python API لإزالة الخلفية
    ├── requirements.txt                    # مكتبات Python
    ├── start.bat                           # تشغيل سريع (Windows)
    └── README.md                           # دليل Python API
```

### التقنيات المستخدمة

1. **Gemini 3 Flash Preview** (Google AI)
   - تحليل الصور واستخراج المعلومات
   - مجاني مع حدود معقولة

2. **rembg** (Python - مفتوح المصدر)
   - إزالة خلفية الصور
   - مجاني 100% بدون حدود
   - يعمل محلياً على جهازك

3. **Next.js 16** + **React 19**
   - واجهة المستخدم

4. **Supabase**
   - قاعدة البيانات
   - تخزين الصور

---

## استكشاف الأخطاء

### المشكلة: "Failed to fetch" عند معالجة الصور

**السبب**: Python API غير مشغل

**الحل**:
```bash
cd admin/python-api
python remove_bg.py
```

### المشكلة: "ModuleNotFoundError: No module named 'rembg'"

**الحل**:
```bash
cd admin/python-api
pip install -r requirements.txt
```

### المشكلة: بطء في أول استخدام لإزالة الخلفية

**السبب**: rembg يحمل النموذج في أول مرة (حوالي 170MB)

**الحل**: انتظر قليلاً، المرات القادمة ستكون أسرع

### المشكلة: "API key not valid" من Gemini

**السبب**: API key منتهي أو غير صحيح

**الحل**: 
1. اذهب إلى: https://aistudio.google.com/app/apikey
2. أنشئ API key جديد
3. ضعه في: `admin/src/app/api/ai/analyze-product/route.ts`

### المشكلة: الصور لا تُرفع إلى Supabase

**الحل**: تحقق من:
1. Supabase Storage bucket اسمه `products`
2. RLS policies تسمح بالرفع
3. الـ API keys صحيحة في `.env`

---

## الأداء والتكلفة

### السرعة
- **تحليل الصور**: 3-5 ثواني
- **إزالة الخلفية**: 2-4 ثواني (أول مرة أبطأ)
- **رفع الصورة**: 1-2 ثانية
- **الإجمالي**: 6-11 ثانية

### التكلفة
- **Gemini API**: مجاني (حدود معقولة)
- **rembg**: مجاني 100% بدون حدود
- **Supabase Storage**: مجاني حتى 1GB
- **الإجمالي**: مجاني للبداية

---

## التحسينات المستقبلية

### 1. معالجة دفعات
إضافة عدة منتجات دفعة واحدة

### 2. تحسين دقة التحليل
تدريب نموذج مخصص للمنتجات العراقية

### 3. دعم الفيديو
استخدام BackgroundRemover لإزالة خلفية الفيديو

### 4. تحسين الأداء
- Cache للنماذج
- معالجة متوازية
- ضغط أفضل للصور

---

## الدعم

للمساعدة أو الإبلاغ عن مشاكل:
1. تحقق من console logs في المتصفح (F12)
2. تحقق من terminal logs للـ Next.js و Python
3. راجع هذا الدليل

---

## الخلاصة

هذه الميزة توفر **90% من الوقت** عند إضافة المنتجات:

**قبل**: 5-10 دقائق لكل منتج (إدخال يدوي)
**بعد**: 30-60 ثانية لكل منتج (تصوير فقط)

**مجانية 100%** ومفتوحة المصدر ✅
